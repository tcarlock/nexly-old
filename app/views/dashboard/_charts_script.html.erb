<script type="text/javascript">
	$(function() {
		var height = 193;
		var labelFont = '13px';

		if ($('#traffic-trend-chart').length == 1) {
			new Highcharts.Chart({
				credits: {
					enabled: false
				},
				chart: {
					renderTo: 'traffic-trend-chart',
					defaultSeriesType: 'area',
					height: 177,
					width: 505
				},
				title: {
					text: 'Monthly Page Views',
					style: {
						fontSize: '13px'
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						borderWidth: 0,
						shadow: false,
						marker: {
               				enabled: false,
               				symbol: 'circle',
							radius: 2,
							states: {
							  hover: {
							     enabled: true
							  }
							}
               			}
					}
				},
				tooltip: {
					borderWidth: 1,
					borderColor: '#909090',
					formatter: function() {
			        	return this.total + ' total page views' + '<br />' + this.y + ' ' + this.series.name.toLowerCase();
			      	}
			    },
				legend: {
					enabled: true
				},
				colors: [
					'#92C1E9',
					'#AA4643',
					'#abdb73',
					'#80699B',
					'#3D96AE'
				],
				xAxis: {
					type: 'datetime',
					labels: {
						style: {
							fontSize: labelFont
						},
						formatter: function() {
			               return Highcharts.dateFormat('%b', this.value);
			            }
					},
					tickInterval: 24 * 3600 * 1000 * 30
				},
				yAxis: {
					title: {
						text: null
					},
					labels: {
						style: {
							fontSize: labelFont
						}
					}
				},
				series: [{
					name: 'From Reviews',
					data: <%= raw @review_page_view_time_series %>
				},{
					name: 'From Recommendations',
					data: <%= raw @recommendation_page_view_time_series %>
				}]
			});
		}
		
		if ($('#rating-dist-chart').length == 1) {
			new Highcharts.Chart({
				credits: {
					enabled: false
				},
				chart: {
					renderTo: 'rating-dist-chart',
					defaultSeriesType: 'bar',
					height:height,
					width:230
				},
				title: {
					text: 'Rating Distribution',
					style: {
						fontSize: '13px'
					}
				},
				legend: {
					enabled: false
				},
				plotOptions: {
					bar: {
						stacking: 'normal',
						pointPadding: 0.05,
						groupPadding: 0,
						borderWidth: 0,
						shadow: false
					}
				},
				tooltip: {
					borderWidth: 1,
					borderColor: '#909090',
					formatter: function() {
			        	return '<b>' + this.y + ' ratings</b>';
			      	}
			    },
				xAxis: {
			        categories: ['5 stars', '4 stars', '3 stars', '2 stars', '1 star'],
			        title: {
			        	text: null
			        },
					labels: {
						style: {
							fontSize: labelFont
						}
					}
			    },
				yAxis: {
					gridLineWidth: 0,
					labels: {
						enabled: false
					},
					title: {
						text: null
					}
				},
				series: [{
					name: 'Rating Distribution',
					data: <%= raw @rating_dist.reverse! %>
				}]
			});
		}

		if ($('#channel-allocation-chart').length == 1) {
			new Highcharts.Chart({
				credits: {
					enabled: false
				},
				chart: {
					renderTo: 'channel-allocation-chart',
					defaultSeriesType: 'pie',
					height:height,
					width:323
				},
				title: {
					text: 'Sources of Web Traffic (by Channel)',
					style: {
						fontSize: '13px'
					}
				},
				legend: {
					enabled: true,
					layout: 'vertical',
					align: 'right',
					verticalAlign: 'middle',
					borderWidth: 0,
					itemStyle: {
						fontSize: '13px'
					},
					labelFormatter: function() {
			        	return this.name + ' (' + Math.round(this.y) + '%)';
			      	},
				},
				xAxis: {
					labels: {
						style: {
							fontSize: labelFont
						}
					}
				},
				yAxis: {
					labels: {
						style: {
							fontSize: labelFont
						}
					}
				},
				plotOptions: {
					pie: {
						size: '90%',
						dataLabels: {
							distance: 20,
							formatter: function() {
					        	return this.point.name + '<br />(' + Math.round(this.percentage) + '%)';
					      	},
					      	enabled: false
	            		},
	            		showInLegend: true
					}
				},
				tooltip: {
					borderWidth: 1,
					borderColor: '#909090',
					formatter: function() {
			        	return this.point.name + ' (' + Math.round(this.percentage) + '%)';
			      	}
			    },
				series: [{
					data: <%= raw @channel_allocation %>
				}]
			});
		}

		if ($('#platform-allocation-chart').length == 1) {
			new Highcharts.Chart({
				credits: {
					enabled: false
				},
				chart: {
					renderTo: 'platform-allocation-chart',
					defaultSeriesType: 'pie',
					height:height,
					width:323
				},
				title: {
					text: 'Sources of Web Traffic (by Site)',
					style: {
						fontSize: '13px'
					}
				},
				legend: {
					enabled: true,
					layout: 'vertical',
					align: 'right',
					verticalAlign: 'middle',
					borderWidth: 0,
					itemStyle: {
						fontSize: '13px'
					},
					labelFormatter: function() {
			        	return this.name + ' (' + Math.round(this.y) + '%)';
			      	},
				},
				xAxis: {
					labels: {
						style: {
							fontSize: labelFont
						}
					}
				},
				yAxis: {
					labels: {
						style: {
							fontSize: labelFont
						}
					}
				},
				plotOptions: {
					pie: {
						size: '90%',
						dataLabels: {
							distance: 20,
							formatter: function() {
					        	return this.point.name + '<br />(' + Math.round(this.percentage) + '%)';
					      	},
					      	enabled: false
	            		},
	            		showInLegend: true
					}
				},
				tooltip: {
					borderWidth: 1,
					borderColor: '#909090',
					formatter: function() {
			        	return this.point.name + ' (' + Math.round(this.percentage) + '%)';
			      	}
			    },
				series: [{
					data: <%= raw @platform_allocation %>
				}]
			});
		}
	});
</script>